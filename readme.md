Задача: в работающей системе "Учет продовольствия в ДОУ" обнаружена ошибка, проявляющаяся в редких (и понятных) случаях
Ошибка проявляется в результате работы хранимой процедуры, в которой используется достаточно сложная табличная функция
[f_fooMenuByExpDocumentVersion]
Надо:
1) зафиксировать ошибку, написать тестовый код, позволяющий понять, что 1) ошибка исправлена 2) не создано новых
при том, что для данной ветки кода вообще отсутствует тестовое покрытие
2) исправить ошибку
3) по-возможности отрефакторить код (оформить, декомпозировать)

исходный код табличной функции - "00 initial code.sql"

код для тестирования результата рефакторинга - "01 test code.sql"
стратегия тестирования - проверяем на исторических данных ,результаты сверяем с работой предыдущей версией функцией
- должно быть тотальное совпадение, кроме ситуаций, которые собственно и пытаемся учесть

результирующий код - "02 result code.sql"

